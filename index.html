<style>
    body {
        background-color: #ecf0f1;
        padding: 0;
        margin: 0;
    }

    #container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 60%;
        margin: auto;
    }

    .message {
        max-width: 60%;
        max-height: 0;
        margin: 0;
        padding: 0;
        overflow: hidden;
        transition: max-height 10s linear, padding 1s linear, margin 1s linear, transform 1s linear;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    p {
        display: inline;
        font-family: sans-serif;
        color: white;
        white-space: pre-line;
        font-size: 1.25em;
    }

    img {
        width: 35px;
        height: 60px;
        padding-right: 25px;
    }

    .new1 {
        transform: scale(1.5);
        margin-top: 50px !important;
        margin-bottom: 50px !important;
    }

    .new2 {
        transform: scale(1.3);
        margin-top: 40px !important;
        margin-bottom: 40px !important;
    }

    .new3 {
        transform: scale(1.1);
        margin-top: 30px !important;
        margin-bottom: 30px !important;
    }
</style>

<canvas style="position: fixed; width: 100%; height: 100%; z-index: -1;"></canvas>
<script src="triangles.js"></script>

<div id="container"></div>

<script>
    var container = document.getElementById('container');
    var lastId = -1;
    var colors = ['#27ae60',
        '#2980b9',  //3498db
        '#8e44ad',
        '#e67e22',
        '#c0392b'];

    function checkMessages(initialLoad) {
        fetch('/messages?from=' + (lastId + 1)).then(response => response.json()).then(data => {
            for (var d of data) {

                var div = document.createElement('div');
                div.className = 'message';
                div.style['background-color'] = colors[Math.floor(Math.random() * colors.length)];

                var p = document.createElement('p');
                p.innerHTML = d.message;

                var img = document.createElement('img');
                img.src = 'lissa.svg';

                div.appendChild(img);

                div.appendChild(p);

                container.insertBefore(div, container.firstChild);
                lastId = d.id;

                var animate = function (div) {
                    setTimeout(() => {
                        div.style['max-height'] = '1000px';
                        div.style['margin'] = '15px';
                        div.style['padding'] = '10px 10px 10px 0';
                        if (!initialLoad) {
                            div.classList.add('new1');

                            container.children[1].classList.remove('new1');
                            container.children[1].classList.add('new2');

                            container.children[2].classList.remove('new2');
                            container.children[2].classList.add('new3');

                            container.children[3].classList.remove('new3');
                        }
                    }, 100);
                };

                animate(div);
            }
        });
    }

    checkMessages(true);

    setInterval(() => checkMessages(false), 1000);

    doStuff();
</script>